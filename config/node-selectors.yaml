node_defaults:
  spawn_on:
    group: ocio
  spec:
    volumes:
      - name: local-home
        persistentVolumeClaim:
          claimName: local-home
    volume_mounts:
      - name: local-home
        mountPath: '/home/'
  
node_selectors:
  - filter:
      gnames:
        - lsst
        - lsst-a
        - lsst-b
        - lsst-c
        - lsst-d
        - lsst-e
        - lsst-f
        - lsst-g
        - lsst-h
        - lsst-i
        - lsst-j
        - lsst-k
        - lsst-l
        - lsst-m
        - lsst-n
        - lsst-o
        - lsst-p
        - lsst-q
        - lsst-r
        - lsst-s
        - lsst-t
        - lsst-u
        - lsst-v
        - lsst-w
        - lsst-y
        - lsst-z
        - lsst-ccs
      images:
        - jld-lab
    spawn_on:
      group: lsst
    spec:
      volumes:
        - name: lsst-home
          persistentVolumeClaim:
            claimName: lsst-home
        - name: lsst-data
          persistentVolumeClaim:
            claimName: lsst-data
      volume_mounts:
        - name: 'lsst-home'
          mountPath: '/home/'
        - name: 'lsst-data'
          mountPath: '/data/'
        

  - filter:
      images:
        - slac-jupyterlab-gpu
    spawn_on:
      group: ocio
      accelerator: nvidia
    spec:
        volumes: 
          - name: local-home
            persistentVolumeClaim:
              claimName: local-home
          #- name: scratch
          #  persistentVolumeClaim:
          #    claimName: scratch
          - name: gpfs
            persistentVolumeClaim:
              claimName: gpfs
          - name: nfs
            persistentVolumeClaim:
              claimName: nfs
        volume_mounts: 
          - name: local-home
            mountPath: '/home/'
          #- name: scratch
          #  mountPath: '/scratch/'
          - name: nfs
            mountPath: '/nfs/'
          - name: gpfs
            mountPath: '/gpfs/'
        cpu: 4
        memory: 10G
        extra_resource_limits:
          nvidia.com/gpu: "1"

  - filter:
      images:
        - cryosparc-docker
    spawn_on:
      group: cryoem
      accelerator: nvidia
    spec:
        volumes:
          - name: cryoem-home
            persistentVolumeClaim:
              claimName: cryoem-home
          - name: cryoem-exp
            persistentVolumeClaim:
              claimName: cryoem-exp
          - name: scratch
            persistentVolumeClaim:
              claimName: scratch
        volume_mounts:
          - name: cryoem-home
            mountPath: '/gpfs/slac/cryo/fs1/u/'
          - name: cryoem-exp
            mountPath: '/gpfs/slac/cryo/fs1/exp/'
          - name: scratch
            mountPath: '/scratch/'
        cpu: 4
        memory: 12G
        extra_resource_limits:
          nvidia.com/gpu: "2"
        env:
          CRYOSPARC_HTTP_PORT: 39000
          CRYOSPARC_LICENSE_ID: 08558f50-a6f5-11e8-aadc-6715b98a5809
          HOMEDIRS: '/gpfs/slac/cryo/fs1/u/'
          EXP_DIR: '/gpfs/slac/cryo/fs1/exp/'
